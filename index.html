// figure out base image once from template
const baseUrl = template.layout?.baseImage || template.base_image || null;

// initial render
renderPreview(template.layout, { ...ctx.prefill, template_id: template.template_id }, baseUrl);

// on input change
document.getElementById('c-form').addEventListener('input', () => {
  const current = {};
  (template.fields || []).forEach(f => {
    if (f.type === 'text') {
      const el = document.getElementById(`f_${f.key}`);
      current[f.key] = (el?.value || '').trim();
    }
    if (f.type === 'image') {
      const urlEl = document.getElementById(`f_${f.key}_url`);
      current[f.key] = (urlEl?.value || '').trim();
    }
  });
  renderPreview(template.layout, { ...current, template_id: template.template_id }, baseUrl);
});
